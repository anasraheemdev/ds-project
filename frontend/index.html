<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Management System</title>
    <link rel="stylesheet" href="style.css?v=6">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav">
            <div class="logo-area">
                <div class="logo-icon"><i class="fa-solid fa-hospital-user"></i></div>
                <div class="logo-text">MED<span class="highlight">STRUCT</span></div>
            </div>

            <ul class="nav-links">
                <li class="nav-item active" onclick="switchTab('dashboard')">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" onclick="switchTab('patients')">
                    <i class="fa-solid fa-users"></i>
                    <span>Patients</span>
                </li>
                <li class="nav-item" onclick="switchTab('appointments')">
                    <i class="fa-solid fa-clock"></i>
                    <span>Queue (FIFO)</span>
                </li>
                <li class="nav-item" onclick="switchTab('activities')">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    <span>History (Stack)</span>
                </li>
            </ul>

            <div class="nav-footer">
                <div class="status-card">
                    <div class="status-indicator online"></div>
                    <span>System Online</span>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-header">
                <div class="header-title">
                    <h1 id="pageTitle">Dashboard</h1>
                    <p class="subtitle">Data Structures & Algorithms Project</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary"
                        onclick="switchTab('patients'); document.getElementById('name').focus();">
                        <i class="fa-solid fa-plus"></i> New Patient
                    </button>
                    <div class="user-profile">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" alt="Admin">
                    </div>
                </div>
            </header>

            <!-- TAB 1: DASHBOARD -->
            <div id="dashboard" class="tab-pane active">
                <!-- Stats Row -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon bg-blue"><i class="fa-solid fa-users"></i></div>
                        <div class="stat-info">
                            <h3>Total Patients</h3>
                            <div class="stat-value" id="dashTotalPatients">0</div>
                            <span class="stat-badge">Linked List</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-purple"><i class="fa-solid fa-user-clock"></i></div>
                        <div class="stat-info">
                            <h3>Waiting Queue</h3>
                            <div class="stat-value" id="dashQueueCount">0</div>
                            <span class="stat-badge">FIFO Queue</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-orange"><i class="fa-solid fa-list-check"></i></div>
                        <div class="stat-info">
                            <h3>Activities</h3>
                            <div class="stat-value" id="dashActivityCount">0</div>
                            <span class="stat-badge">LIFO Stack</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Content -->
                <div class="dashboard-grid">
                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fa-solid fa-bolt"></i> Quick Actions</h2>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="loadSampleData()">
                                <i class="fa-solid fa-database"></i>
                                <span>Load Sample Data</span>
                            </button>
                            <button class="action-btn" onclick="exportData()">
                                <i class="fa-solid fa-file-export"></i>
                                <span>Export Data</span>
                            </button>
                            <button class="action-btn danger" onclick="clearAllData()">
                                <i class="fa-solid fa-trash-can"></i>
                                <span>Reset System</span>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity Preview -->
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fa-solid fa-history"></i> Recent Activity</h2>
                            <button class="btn-link" onclick="switchTab('activities')">View All</button>
                        </div>
                        <div class="activity-list small" id="dashActivityList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: PATIENTS -->
            <div id="patients" class="tab-pane">
                <div class="content-split">
                    <!-- Register/Search Sidebar -->
                    <div class="content-sidebar">

                        <!-- Toggle Buttons -->
                        <div class="form-toggle">
                            <button class="toggle-btn active" onclick="showForm('add')">Register</button>
                            <button class="toggle-btn" onclick="showForm('search')">Search</button>
                        </div>

                        <!-- Add Patient Form -->
                        <div id="addFormContainer">
                            <form id="addPatientForm" class="styled-form">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <div class="input-with-icon">
                                        <i class="fa-solid fa-user"></i>
                                        <input type="text" id="name" name="name" required placeholder="Ex: John Doe">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Age</label>
                                        <input type="number" id="age" name="age" required min="0" max="150"
                                            placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Gender</label>
                                        <select id="gender" name="gender" required>
                                            <option value="">Select</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Disease / Condition</label>
                                    <div class="input-with-icon">
                                        <i class="fa-solid fa-stethoscope"></i>
                                        <input type="text" id="disease" name="disease" required placeholder="Diagnosis">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Contact Number</label>
                                    <div class="input-with-icon">
                                        <i class="fa-solid fa-phone"></i>
                                        <input type="tel" id="contactNumber" name="contactNumber" required
                                            placeholder="Phone">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="appointmentDate" name="appointmentDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Notes</label>
                                    <textarea id="visitNotes" name="visitNotes" rows="2"
                                        placeholder="Optional notes..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary full-width">
                                    Add Patient
                                </button>
                            </form>
                        </div>

                        <!-- Search Forms -->
                        <div id="searchFormContainer" class="hidden">
                            <div class="search-box">
                                <label>Search by ID (BST O(log n))</label>
                                <form id="searchPatientForm" class="flex-form">
                                    <input type="number" id="searchId" required placeholder="Patient ID">
                                    <button type="submit" class="btn btn-secondary"><i
                                            class="fa-solid fa-search"></i></button>
                                </form>
                            </div>
                            <div class="search-box mt-3">
                                <label>Search by Name</label>
                                <form id="searchByNameForm" class="flex-form">
                                    <input type="text" id="searchName" required placeholder="Patient Name">
                                    <button type="submit" class="btn btn-secondary"><i
                                            class="fa-solid fa-search"></i></button>
                                </form>
                            </div>
                            <div id="searchResult" class="search-result-card hidden"></div>
                        </div>
                    </div>

                    <!-- Patient List Table -->
                    <div class="content-table-area">
                        <div class="table-header">
                            <h2>All Patients</h2>
                            <div class="table-actions">
                                <button class="btn btn-small btn-outline" onclick="loadPatientsSorted()">
                                    <i class="fa-solid fa-sort-numeric-down"></i> Sort by ID (BST)
                                </button>
                                <button class="btn btn-small btn-outline" onclick="loadPatients()">
                                    <i class="fa-solid fa-rotate-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Details</th>
                                        <th>Condition</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="patientTableBody">
                                    <!-- Rows populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div id="emptyState" class="empty-state">
                            <i class="fa-solid fa-folder-open"></i>
                            <p>No records found</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: APPOINTMENTS (QUEUE) -->
            <div id="appointments" class="tab-pane">
                <div class="queue-layout">
                    <!-- Current Appointment -->
                    <div class="queue-process-card">
                        <div class="card-header centered">
                            <h2>Next in Line</h2>
                            <span class="ds-badge">Front of Queue</span>
                        </div>
                        <div class="current-patient" id="nextupContainer">
                            <div class="avatar-placeholder big">?</div>
                            <h3 id="nextupName">Nobody Waiting</h3>
                            <p id="nextupId">--</p>
                            <button class="btn btn-success btn-lg" onclick="processNextAppointment()">
                                <i class="fa-solid fa-check-circle"></i> Complete Appointment
                            </button>
                        </div>
                    </div>

                    <!-- Queue List -->
                    <div class="queue-list-card">
                        <div class="card-header">
                            <h2>Waiting List</h2>
                            <span class="count-badge" id="queueCountBadge">0</span>
                        </div>
                        <div class="queue-items-container" id="queueList">
                            <!-- Queue Items -->
                        </div>
                        <div id="queueEmpty" class="empty-state">
                            <i class="fa-solid fa-mug-hot"></i>
                            <p>The waiting room is empty</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 4: HISTORY (STACK) -->
            <div id="activities" class="tab-pane">
                <div class="card full-height">
                    <div class="card-header">
                        <h2>System Logs</h2>
                        <div class="header-actions">
                            <span class="ds-badge warning">LIFO Stack</span>
                            <button class="btn btn-small btn-danger" onclick="popActivity()">
                                <i class="fa-solid fa-undo"></i> Undo Last
                            </button>
                        </div>
                    </div>
                    <div class="timeline-container" id="activityList">
                        <!-- Timeline Items -->
                    </div>
                    <div id="activityEmpty" class="empty-state">
                        <i class="fa-solid fa-history"></i>
                        <p>No recent history</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Edit Patient</h3>
                <button onclick="closeEditModal()"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="editPatientForm" class="styled-form">
                    <input type="hidden" id="editPatientId">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="editName" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Age</label><input type="number" id="editAge" required></div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="editGender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label>Condition</label><input type="text" id="editDisease" required></div>
                    <div class="form-group"><label>Contact</label><input type="text" id="editContactNumber" required>
                    </div>
                    <div class="form-group"><label>Date</label><input type="date" id="editAppointmentDate" required>
                    </div>
                    <div class="form-group"><label>Notes</label><textarea id="editVisitNotes"></textarea></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script src="script.js?v=6"></script>
    <script>
        // Simple Tab Switching Logic (Inline for speed, moved to script.js ideally)
        function switchTab(tabId) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(el => el.classList.remove('active'));
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // Show target
            document.getElementById(tabId).classList.add('active');

            // Highlight nav
            const navItem = Array.from(document.querySelectorAll('.nav-item')).find(el => el.getAttribute('onclick').includes(tabId));
            if (navItem) navItem.classList.add('active');

            // Update title
            const titles = {
                'dashboard': 'Dashboard',
                'patients': 'Patient Management',
                'appointments': 'Appointment Queue',
                'activities': 'Activity History'
            };
            document.getElementById('pageTitle').innerText = titles[tabId];

            // Refresh data if needed
            if (tabId === 'appointments') loadQueue();
            if (tabId === 'activities') loadActivities();
        }

        function showForm(type) {
            const addContainer = document.getElementById('addFormContainer');
            const searchContainer = document.getElementById('searchFormContainer');
            const toggles = document.querySelectorAll('.toggle-btn');

            if (type === 'add') {
                addContainer.classList.remove('hidden');
                searchContainer.classList.add('hidden');
                toggles[0].classList.add('active');
                toggles[1].classList.remove('active');
            } else {
                addContainer.classList.add('hidden');
                searchContainer.classList.remove('hidden');
                toggles[0].classList.remove('active');
                toggles[1].classList.add('active');
            }
        }
    </script>
</body>

</html>